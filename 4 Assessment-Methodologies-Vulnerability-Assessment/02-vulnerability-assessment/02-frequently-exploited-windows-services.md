# Frequently Exploited Windows Services

## Introduction to Windows Service Vulnerabilities

This guide focuses on native Windows services and protocols that are commonly exploited during penetration tests. Understanding these core services is essential for both offensive security professionals and defenders.

## Core Windows Services Overview

### 1. Microsoft IIS (Internet Information Services)

**Default Ports:** TCP 80 (HTTP), 443 (HTTPS)

**Purpose:**

- Proprietary web server software developed by Microsoft
- Hosts web applications, document repositories, and internal sites
- Commonly found in enterprise environments for hosting internal applications

**Key Characteristics:**

- Integrated with Windows Server editions
- Supports ASP.NET, PHP, and other web technologies
- Often used for SharePoint, Outlook Web Access, and custom applications

**Detection Commands:**

```bash
# Network scanning
nmap -sV -p 80,443 <target_ip>

# Banner grabbing
curl -I http://<target_ip>/
nc -nv <target_ip> 80
```

### 2. WebDAV (Web Distributed Authoring and Versioning)

**Default Ports:** TCP 80 (HTTP), 443 (HTTPS)

**Purpose:**

- HTTP extension protocol for remote web content authoring
- Enables file management operations (create, read, update, delete) over HTTP
- Often enabled on IIS servers for document collaboration

**Key Characteristics:**

- Extends HTTP with additional methods (PROPFIND, MKCOL, PUT, DELETE)
- Commonly misconfigured with excessive permissions
- Can be exploited for arbitrary file upload

**Testing Methods:**

```bash
# Check WebDAV methods
curl -X OPTIONS http://<target_ip>/ -I

# Test file upload capability
curl -X PUT http://<target_ip>/test.txt -d "test content"
```

### 3. SMB (Server Message Block)

**Default Port:** TCP 445

**Purpose:**

- Network file and resource sharing protocol
- Facilitates file sharing, printer sharing, and inter-process communication
- Core component of Windows networking

**Key Characteristics:**

- Enabled by default on most Windows systems
- Historically vulnerable to major exploits (EternalBlue, EternalRomance)
- Provides rich attack surface for enumeration and exploitation

**Enumeration Commands:**

```bash
# SMB version detection
nmap -p 445 --script smb-protocols <target_ip>

# Share enumeration
smbclient -L //<target_ip>/ -N
enum4linux <target_ip>

# Metasploit modules
use auxiliary/scanner/smb/smb_version
use auxiliary/scanner/smb/smb_enumshares
```

### 4. RDP (Remote Desktop Protocol)

**Default Port:** TCP 3389

**Purpose:**

- Proprietary remote access protocol providing GUI interface
- Allows remote control of Windows systems
- Commonly used for administrative access and remote work

**Key Characteristics:**

- Disabled by default on client editions, often enabled on servers
- Vulnerable to credential brute-forcing and BlueKeep-type exploits
- Can be used for lateral movement once credentials are obtained

**Testing Approaches:**

```bash
# RDP service detection
nmap -p 3389 --script rdp-ntlm-info <target_ip>

# Credential testing
crowbar -b rdp -s <target_ip>/32 -u <username> -C <wordlist> -n 1

# Check for BlueKeep vulnerability
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
```

### 5. WinRM (Windows Remote Management)

**Default Ports:** TCP 5985 (HTTP), 5986 (HTTPS)

**Purpose:**

- Protocol for remote Windows system management
- Enables PowerShell remoting and command execution
- Microsoft's implementation of WS-Management protocol

**Key Characteristics:**

- Increasingly common in modern Windows environments
- Used for DevOps automation and system administration
- Can provide direct command execution with proper credentials

**Testing Methods:**

```bash
# WinRM service detection
nmap -p 5985,5986 --script winrm-version <target_ip>

# PowerShell remoting test
Test-WSMan <target_ip>

# Credential-based access
evil-winrm -i <target_ip> -u <username> -p <password>
```

## Service Interaction Patterns

### Default Configuration States

```bash
# Typical service status on different Windows versions
# Windows 10/11 Client: SMB enabled, RDP disabled, WinRM disabled
# Windows Server: SMB enabled, RDP enabled, WinRM often enabled
```

### Network Scanning Methodology

```bash
# Comprehensive Windows service scan
nmap -sS -sV -p 80,443,445,3389,5985,5986 <target_ip>

# Script scanning for vulnerabilities
nmap --script smb-vuln*,rdp-vuln*,http-vuln* <target_ip>
```

## Attack Surface Analysis

### Service Prevalence in Enterprise Environments

- **SMB**: Nearly 100% of Windows systems
- **IIS**: Common on servers (40-60% of enterprise Windows servers)
- **RDP**: Enabled on 70-80% of servers, 20-30% of workstations
- **WinRM**: Growing adoption (30-40% in modern environments)
- **WebDAV**: Less common but high-impact when misconfigured (10-20%)

### Risk Prioritization Matrix

```bash
# High Risk: External exposure + known vulnerabilities
# Medium Risk: Internal only + weak authentication
# Low Risk: Properly configured + updated systems
```

## Practical Detection Script

```bash
#!/bin/bash
# windows_service_scanner.sh
TARGET=$1

echo "[*] Scanning Windows services on $TARGET"

# Quick service discovery
echo "[*] Basic service detection..."
nmap -p 80,443,445,3389,5985,5986 --open $TARGET

# Detailed vulnerability scanning
echo "[*] Running vulnerability checks..."
nmap -p 445 --script smb-vuln* $TARGET
nmap -p 3389 --script rdp-ntlm-info,rdp-enum-encryption $TARGET

# Web service checks
echo "[*] Checking web services..."
nmap -p 80,443 --script http-methods,http-security-headers $TARGET

echo "[*] Scan complete"
```

## Defense and Mitigation

### Hardening Recommendations

**SMB Security:**

```powershell
# Disable SMBv1
Set-SmbServerConfiguration -EnableSMB1Protocol $false
# Restrict anonymous access
Set-SmbServerConfiguration -EnableSecuritySignature $true
```

**RDP Security:**

```powershell
# Enable Network Level Authentication
Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "UserAuthentication" -Value 1
# Change default port
Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "PortNumber" -Value 33890
```

**IIS/WebDAV Security:**

```powershell
# Disable WebDAV if not required
Remove-WebGlobalModule -Name "WebDAVModule"
# Restrict HTTP methods
Set-WebConfigurationProperty -Filter /system.webServer/security/requestFiltering -Name allowUnlisted -Value $false
```

## Lab Environment Setup

### Free Practice Resources

**TryHackMe Windows Rooms:**

- [Internal](https://tryhackme.com/room/internal)
- [Anthem](https://tryhackme.com/room/anthem)
- [Retro](https://tryhackme.com/room/retro)

**Hack The Box:**

- Various Windows machines with different service configurations
- Requires free account registration

### Custom Lab Creation

```bash
# Using Windows Server Evaluation (180-day trial)
# Enable specific services for testing:
# - IIS: Server Manager → Add Roles → Web Server
# - RDP: System Properties → Remote Desktop
# - WinRM: Enable-PSRemoting
```

## Key Takeaways

1. **SMB is ubiquitous** and provides extensive attack surface
2. **RDP exposure** often leads to direct compromise through credential attacks
3. **WinRM is emerging** as a primary remote management vector
4. **IIS misconfigurations** can lead to web shell deployment
5. **WebDAV when enabled** frequently has excessive permissions
6. **Service combinations** often enable lateral movement

Understanding these core Windows services and their common vulnerabilities provides a foundation for both penetration testing and defensive security hardening in Windows environments.
